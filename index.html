<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;title&gt;Advanced Cre-Lox Simulator&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>:root {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>--loxp: #0072B2; --l22: #E69F00; --l511: #56B4E9; --ln: #F0E442;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>--orf: #CC79A7; --pA: #000000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.container { max-width: 1100px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.piece-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>position: relative; padding: 10px 5px; cursor: grab; display: flex; align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.piece-wrapper:active { cursor: grabbing; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.dna-block {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>height: 38px; min-width: 85px; padding: 0 12px; color: white;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>font-weight: bold; display: flex; align-items: center; justify-content: center;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>font-size: 11px; user-select: none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>clip-path: polygon(0% 0%, 85% 0%, 100% 50%, 85% 100%, 0% 100%);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.piece-wrapper.rev .dna-block { clip-path: polygon(15% 0%, 100% 0%, 100% 100%, 15% 100%, 0% 50%); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.l22, .ln { color: #000 !important; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.p { background: var(--loxp); } .l22 { background: var(--l22); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.l511 { background: var(--l511); } .ln { background: var(--ln); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.orf { background: var(--orf); } .pa { background: var(--pA); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toolbox, .strand {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>display: flex; align-items: center; padding: 15px; border-radius: 8px; margin-bottom: 20px;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.toolbox { background: #eee; gap: 5px; flex-wrap: wrap; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.strand { min-height: 100px; border: 2px dashed #ccc; gap: 2px; background: #fff; overflow-x: auto; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.strand.drag-over { background: #e3f2fd; border-color: var(--loxp); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.delete-btn {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>position: absolute; top: 0; right: 0; color: black; font-size: 16px;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>cursor: pointer; font-weight: bold; display: none; z-index: 20; text-shadow: 0 0 2px white;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.piece-wrapper:hover .delete-btn { display: block; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.share-box { display: flex; gap: 10px; margin-bottom: 20px; background: #f9f9f9; padding: 15px; border-radius: 8px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>input#sequence-string { flex-grow: 1; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: monospace; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.summary-table { width: 100%; border-collapse: collapse; margin: 20px 0; border: 1px solid #ddd; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.summary-table th, .summary-table td { padding: 10px; border: 1px solid #ddd; text-align: left; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.summary-table th { background: #f4f4f4; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.outcome-box { border: 1px solid #ddd; padding: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; border-radius: 6px; font-size: 11px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.express-tag { padding: 2px 8px; border-radius: 4px; background: #333; color: #fff; font-weight: bold; min-width: 90px; text-align: center; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>button { cursor: pointer; padding: 10px 20px; border-radius: 6px; border: none; font-weight: bold; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.btn-primary { background: #2c3e50; color: #fff; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;div class="container"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h2&gt;ðŸ§¬ Dynamic Cre-Lox Simulator&lt;/h2&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="share-box"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input type="text" id="sequence-string" placeholder="Construct code (e.g. P1,A1,P1)"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button onclick="loadFromCode()"&gt;Load Code&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button onclick="updateCode()"&gt;Refresh Code&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="toolbox" id="toolbox"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-source="toolbox" data-id="P"&gt;&lt;div class="dna-block p"&gt;LoxP&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-source="toolbox" data-id="L2"&gt;&lt;div class="dna-block l22"&gt;Lox2272&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-source="toolbox" data-id="L5"&gt;&lt;div class="dna-block l511"&gt;Lox511&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-source="toolbox" data-id="LN"&gt;&lt;div class="dna-block ln"&gt;LoxN&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-source="toolbox" data-id="PA"&gt;&lt;div class="dna-block pa"&gt;polyA&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-id="A"&gt;&lt;div class="dna-block orf"&gt;ORF-A&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-id="B"&gt;&lt;div class="dna-block orf"&gt;ORF-B&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="piece-wrapper" draggable="true" ondragstart="drag(event)" data-id="C"&gt;&lt;div class="dna-block orf"&gt;ORF-C&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="strand" class="strand" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" ondrop="drop(event)"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div style="display:flex; gap:10px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button class="btn-primary" onclick="runSimulation()"&gt;Simulate Outcomes&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button onclick="clearStrand()"&gt;Reset Strand&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="summary-section"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="results"&gt;&lt;/div&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const strand = document.getElementById('strand');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let draggedData = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const lookup = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"P": {name: "LoxP", type: "LOX", css: "p"}, "L2": {name: "Lox2272", type: "LOX", css: "l22"},</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"L5": {name: "Lox511", type: "LOX", css: "l511"}, "LN": {name: "LoxN", type: "LOX", css: "ln"},</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"PA": {name: "polyA", type: "PA", css: "pa"}, "A": {name: "ORF-A", type: "ORF", css: "orf"},</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"B": {name: "ORF-B", type: "ORF", css: "orf"}, "C": {name: "ORF-C", type: "ORF", css: "orf"}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function allowDrop(ev) { ev.preventDefault(); strand.classList.add('drag-over'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function dragLeave(ev) { strand.classList.remove('drag-over'); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drag(ev) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const isFromStrand = ev.currentTarget.parentElement.id === 'strand';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>draggedData = {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>id: ev.currentTarget.dataset.id,<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>dir: ev.currentTarget.dataset.dir || 1,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>index: isFromStrand ? Array.from(strand.children).indexOf(ev.currentTarget) : -1</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drop(ev) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ev.preventDefault();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>strand.classList.remove('drag-over');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (draggedData.index !== -1) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Reordering internal</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const pieces = [...strand.querySelectorAll('.piece-wrapper')];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const target = pieces.find(s =&gt; ev.clientX &lt; s.getBoundingClientRect().left + s.getBoundingClientRect().width/2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>strand.insertBefore(pieces[draggedData.index], target || null);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// New from toolbox</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>addPiece(draggedData.id, 1, ev.clientX);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateCode();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function addPiece(id, dir, mouseX) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const info = lookup[id];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const wrapper = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wrapper.className = `piece-wrapper placed ${dir == -1 ? 'rev' : ''}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wrapper.dataset.id = id; wrapper.dataset.dir = dir;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wrapper.draggable = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wrapper.ondragstart = drag;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wrapper.innerHTML = `&lt;div class="dna-block ${info.css}"&gt;${info.name}&lt;/div&gt;&lt;div class="delete-btn" onclick="this.parentElement.remove(); updateCode();"&gt;Ã—&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wrapper.onclick = (e) =&gt; { if(e.target.className === 'delete-btn') return; wrapper.dataset.dir = wrapper.dataset.dir == 1 ? -1 : 1; wrapper.classList.toggle('rev'); updateCode(); };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const siblings = [...strand.querySelectorAll('.piece-wrapper')];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const next = siblings.find(s =&gt; mouseX &lt; s.getBoundingClientRect().left + s.getBoundingClientRect().width/2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>strand.insertBefore(wrapper, next || null);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateCode();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateCode() { document.getElementById('sequence-string').value = [...strand.querySelectorAll('.piece-wrapper')].map(el =&gt; `${el.dataset.id}${el.dataset.dir}`).join(','); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function loadFromCode() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>strand.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const code = document.getElementById('sequence-string').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(!code) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>code.split(',').forEach(part =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const match = part.match(/([A-Z0-9]+)(-?\d+)/);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if(match) addPiece(match[1], parseInt(match[2]), 99999);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function clearStrand() { strand.innerHTML = ''; document.getElementById('sequence-string').value = ''; document.getElementById('results').innerHTML = ''; document.getElementById('summary-section').innerHTML = ''; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function runSimulation() {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const initial = [...strand.querySelectorAll('.piece-wrapper')].map(p =&gt; ({ ...lookup[p.dataset.id], id: p.dataset.id, dir: parseInt(p.dataset.dir) }));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(!initial.length) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let visited = new Map();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let queue = [{seq: initial, steps: 0}];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>visited.set(JSON.stringify(initial), 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let outcomes = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>while(queue.length &gt; 0 &amp;&amp; outcomes.length &lt; 150) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let {seq, steps} = queue.shift();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let expr = "None";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>for(let s of seq) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(s.type === 'PA' &amp;&amp; s.dir === 1) { expr = "Blocked"; break; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>if(s.type === 'ORF' &amp;&amp; s.dir === 1) { expr = s.name; break; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>outcomes.push({seq, steps, expr});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let loxIdx = seq.map((s, i) =&gt; s.type === 'LOX' ? i : -1).filter(i =&gt; i !== -1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>for(let i=0; i &lt; loxIdx.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>for(let j=i+1; j &lt; loxIdx.length; j++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(seq[loxIdx[i]].name !== seq[loxIdx[j]].name) continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let nextS = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(seq[loxIdx[i]].dir !== seq[loxIdx[j]].dir) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>let mid = seq.slice(loxIdx[i]+1, loxIdx[j]).reverse().map(s =&gt; ({...s, dir: s.dir * -1}));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS = [...seq.slice(0, loxIdx[i]+1), ...mid, ...seq.slice(loxIdx[j])];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>// EXCISION: Fuse the two Lox sites into one</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>nextS = [...seq.slice(0, loxIdx[i]), seq[loxIdx[i]], ...seq.slice(loxIdx[j] + 1)];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>if(!visited.has(JSON.stringify(nextS))) { visited.set(JSON.stringify(nextS), steps+1); queue.push({seq: nextS, steps: steps+1}); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>render(outcomes);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function render(outcomes) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const stats = {};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>outcomes.forEach(o =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (!stats[o.expr]) stats[o.expr] = new Set();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>stats[o.expr].add(o.steps);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let summaryHtml = `&lt;h3&gt;Phenotype Summary&lt;/h3&gt;&lt;table class="summary-table"&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;Resulting Expression&lt;/th&gt;&lt;th&gt;Steps to Achieve (All Paths)&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>for (let key in stats) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>let stepsArr = Array.from(stats[key]).sort((a,b) =&gt; a-b);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>summaryHtml += `&lt;tr&gt;&lt;td&gt;&lt;strong&gt;${key}&lt;/strong&gt;&lt;/td&gt;&lt;td&gt;${stepsArr.join(', ')}&lt;/td&gt;&lt;/tr&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>summaryHtml += `&lt;/tbody&gt;&lt;/table&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>document.getElementById('summary-section').innerHTML = summaryHtml;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const res = document.getElementById('results');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>res.innerHTML = `&lt;h3&gt;Possible DNA States (${outcomes.length})&lt;/h3&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>outcomes.forEach(o =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const div = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>div.className = 'outcome-box';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const dna = o.seq.map(s =&gt; `&lt;div class="dna-block ${s.css}" style="transform: scale(0.65); min-width:70px; clip-path: polygon(${s.dir==1 ? '0% 0%, 85% 0%, 100% 50%, 85% 100%, 0% 100%' : '15% 0%, 100% 0%, 100% 100%, 15% 100%, 0% 50%'})"&gt;${s.id}&lt;/div&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>div.innerHTML = `&lt;div style="min-width:70px"&gt;Steps: ${o.steps}&lt;/div&gt; &lt;div style="display:flex; flex-grow:1; overflow-x:auto;"&gt;${dna}&lt;/div&gt; &lt;div class="express-tag"&gt;${o.expr}&lt;/div&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>res.appendChild(div);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
